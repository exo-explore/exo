import{f as B,a as _,c as ge}from"../chunks/cZOEMoTm.js";import{o as ye}from"../chunks/Caj52-64.js";import{n as _e,o as At,t as Et,i as he,v as t,w as p,x as Y,y as s,z as K,A as we,B as d,C as o,D as be}from"../chunks/Cs2YbYqB.js";import{d as Me,s as c}from"../chunks/X9orTM-q.js";import{H as Be,r as Kt,t as je,d as $e,l as ke,e as ut,i as mt,s as L,a as Oe,c as De,b as Ct}from"../chunks/BHyprsTR.js";import{i as Z}from"../chunks/BMwDbPWL.js";var Ne=B('<div class="rounded border border-exo-medium-gray/30 bg-exo-black/30 p-6 text-center text-exo-light-gray space-y-2"><div class="text-sm">No downloads found. Start a model download to see progress here.</div> <div class="text-[11px] text-exo-light-gray/70"> </div></div>'),Fe=B("<span> </span>"),Ie=B('<div class="text-[11px] font-mono text-exo-light-gray/70">No file details reported.</div>'),Te=B('<div class="rounded border border-exo-medium-gray/20 bg-exo-black/40 p-2 space-y-1"><div class="flex items-center justify-between text-[11px] font-mono text-exo-light-gray/90"><span class="truncate pr-2"> </span> <span> </span></div> <div class="relative h-1.5 bg-exo-black/60 rounded-sm overflow-hidden"><div></div></div> <div class="flex items-center justify-between text-[10px] text-exo-light-gray/70"><span> </span> <span> </span></div></div>'),Ae=B('<div class="mt-2 space-y-1.5"><!></div>'),Ee=B('<div class="rounded border border-exo-medium-gray/30 bg-exo-dark-gray/60 p-3 space-y-2"><div class="flex items-center justify-between gap-3"><div class="min-w-0 space-y-0.5"><div class="text-sm font-mono text-white truncate"> </div> <div class="text-[11px] text-exo-light-gray font-mono truncate"> </div> <div class="text-[11px] text-exo-light-gray font-mono"> </div></div> <div class="flex items-center gap-2"><span> </span> <button type="button" class="text-exo-light-gray hover:text-exo-yellow transition-colors" title="Toggle file details"><svg class="w-4 h-4" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 8l4 4 4-4"></path></svg></button></div></div> <div class="relative h-2 bg-exo-black/60 rounded-sm overflow-hidden"><div></div></div> <div class="flex items-center justify-between text-xs font-mono text-exo-light-gray"><span> </span> <!></div> <!></div>'),Ke=B('<div class="rounded border border-exo-medium-gray/30 bg-exo-black/30 p-4 space-y-3 flex flex-col"><div class="flex items-center justify-between gap-3"><div class="min-w-0 flex-1"><div class="text-lg font-mono text-white truncate"> </div> <div class="text-xs text-exo-light-gray font-mono truncate"> </div></div> <div class="text-xs font-mono uppercase tracking-wider whitespace-nowrap shrink-0"><span class="text-green-400"> </span><span class="text-exo-yellow"> </span></div></div> <!></div>'),Ce=B('<div class="downloads-grid gap-4 svelte-19lfojq"></div>'),Se=B('<div class="min-h-screen bg-exo-dark-gray text-white"><!> <div class="max-w-7xl mx-auto px-4 lg:px-8 py-6 space-y-6"><div class="flex items-center justify-between gap-4 flex-wrap"><div><h1 class="text-2xl font-mono tracking-[0.2em] uppercase text-exo-yellow">Downloads</h1> <p class="text-sm text-exo-light-gray">Overview of models on each node</p></div> <div class="flex items-center gap-3"><button type="button" class="text-xs font-mono text-exo-light-gray hover:text-exo-yellow transition-colors uppercase border border-exo-medium-gray/40 px-2 py-1 rounded" title="Force refresh from /state">Refresh</button> <div class="text-[11px] font-mono text-exo-light-gray"> </div></div></div> <!></div></div>');function Pe(St,qt){_e(qt,!0);const Gt=p(je),U=p($e);function Ht(e){var n,r,i;const a=(r=(n=t(Gt))==null?void 0:n.nodes)==null?void 0:r[e];return a&&(a.friendly_name||((i=a.system_info)==null?void 0:i.model_id))||e.slice(0,8)}function z(e){if(typeof e=="number")return e;if(e&&typeof e=="object"){const a=e;if(typeof a.in_bytes=="number")return a.in_bytes;if(typeof a.inBytes=="number")return a.inBytes}return 0}function P(e){if(!e||e<=0)return"0B";const a=["B","KB","MB","GB","TB"],n=Math.min(Math.floor(Math.log(e)/Math.log(1024)),a.length-1),r=e/Math.pow(1024,n);return`${r.toFixed(r>=10?0:1)}${a[n]}`}function gt(e){if(!e||e<=0)return"--";const a=Math.round(e/1e3),n=a%60,r=Math.floor(a/60)%60,i=Math.floor(a/3600);return i>0?`${i}h ${r}m`:r>0?`${r}m ${n}s`:`${n}s`}function yt(e){if(!e||e<=0)return"--";const a=["B/s","KB/s","MB/s","GB/s"],n=Math.min(Math.floor(Math.log(e)/Math.log(1024)),a.length-1),r=e/Math.pow(1024,n);return`${r.toFixed(r>=10?0:1)}${a[n]}`}function R(e){return Number.isFinite(e)?Math.min(100,Math.max(0,e)):0}function Lt(e){const a=e.shard_metadata??e.shardMetadata;if(!a||typeof a!="object")return null;const n=a,r=Object.keys(n);if(r.length!==1)return null;const i=n[r[0]];if(!i)return null;const x=i.model_meta??i.modelMeta;if(!x||typeof x!="object")return null;const u=x;return u.model_id??u.modelId??null}function _t(e){return e>=100?"from-green-500 to-green-400":e<=0?"from-red-500 to-red-400":"from-exo-yellow to-exo-yellow/70"}let C=At(Et([]));he(()=>{try{if(!t(U)||Object.keys(t(U)).length===0){Y(C,[],!0);return}const e=Object.entries(t(U)),a=[];for(const[n,r]of e){const i=new Map,x=Array.isArray(r)?r:r&&typeof r=="object"?Object.values(r):[];for(const m of x){if(!m||typeof m!="object")continue;const F=Object.keys(m);if(F.length!==1)continue;const I=F[0],j=m[I];if(!j)continue;const O=Lt(j)??"unknown-model",S=(()=>{const w=j.shard_metadata??j.shardMetadata;if(!w||typeof w!="object")return null;const y=w,v=Object.keys(y);if(v.length!==1)return null;const f=y[v[0]],k=(f==null?void 0:f.model_meta)??(f==null?void 0:f.modelMeta);return!k||typeof k!="object"?null:k.prettyName??null})(),g=j.download_progress??j.downloadProgress??{},T=z(g.total_bytes??g.totalBytes),W=z(g.downloaded_bytes??g.downloadedBytes),at=g.speed??0,D=g.eta_ms??g.etaMs??0,l=T>0?W/T*100:0,q=[],h=g.files;if(h&&typeof h=="object")for(const[w,y]of Object.entries(h)){if(!y||typeof y!="object")continue;const v=y,f=z(v.total_bytes??v.totalBytes),k=z(v.downloaded_bytes??v.downloadedBytes);q.push({name:w,totalBytes:f,downloadedBytes:k,speed:v.speed??0,etaMs:v.eta_ms??v.etaMs??0,percentage:R(f>0?k/f*100:0)})}const N={modelId:O,prettyName:S,percentage:I==="DownloadCompleted"?100:R(l),downloadedBytes:W,totalBytes:T,speed:at,etaMs:D,status:I==="DownloadCompleted"?"completed":"downloading",files:q},$=i.get(O);$?(N.status==="completed"&&$.status!=="completed"||N.status===$.status&&N.downloadedBytes>$.downloadedBytes)&&i.set(O,N):i.set(O,N)}let u=Array.from(i.values()).sort((m,F)=>F.percentage-m.percentage);u.length===0&&x.length>0&&(u=[{modelId:"Unknown download",percentage:0,downloadedBytes:0,totalBytes:0,speed:0,etaMs:0,status:"downloading",files:[]}]),a.push({nodeId:n,nodeName:Ht(n),models:u})}Y(C,a,!0)}catch(e){console.error("Parse downloads error",e),Y(C,[],!0)}});const Ut=p(()=>t(C).length>0),ht=p(ke),wt=p(()=>Object.keys(t(U)||{}));let tt=At(Et(new Set));function zt(e){const a=new Set(t(tt));a.has(e)?a.delete(e):a.add(e),Y(tt,a,!0)}ye(()=>{Kt()});var et=Se(),bt=s(et);Be(bt,{showHome:!0});var Mt=d(bt,2),ot=s(Mt),Bt=d(s(ot),2),jt=s(Bt);jt.__click=()=>Kt();var $t=d(jt,2),Pt=s($t);o($t),o(Bt),o(ot);var Rt=d(ot,2);{var Wt=e=>{var a=Ne(),n=d(s(a),2),r=s(n);o(n),o(a),K(i=>c(r,`Download keys detected: ${i??""}`),[()=>t(wt).length===0?"none":t(wt).join(", ")]),_(e,a)},Jt=e=>{var a=Ce();ut(a,21,()=>t(C),mt,(n,r)=>{var i=Ke(),x=s(i),u=s(x),m=s(u),F=s(m,!0);o(m);var I=d(m,2),j=s(I,!0);o(I),o(u);var O=d(u,2),S=s(O),g=s(S,!0);o(S);var T=d(S),W=s(T);o(T),o(O),o(x);var at=d(x,2);ut(at,17,()=>t(r).models,mt,(D,l)=>{const q=p(()=>`${t(r).nodeId}|${t(l).modelId}`),h=p(()=>R(t(l).percentage)),N=p(()=>_t(t(h))),$=p(()=>t(tt).has(t(q)));var w=Ee(),y=s(w),v=s(y),f=s(v),k=s(f,!0);o(f);var J=d(f,2),Qt=s(J,!0);o(J);var kt=d(J,2),Vt=s(kt);o(kt),o(v);var Ot=d(v,2),Q=s(Ot),Xt=s(Q);o(Q);var V=d(Q,2);V.__click=()=>zt(t(q));var Dt=s(V),Yt=s(Dt);o(Dt),o(V),o(Ot),o(y);var st=d(y,2),Nt=s(st);o(st);var rt=d(st,2),nt=s(rt),Zt=s(nt,!0);o(nt);var te=d(nt,2);{var ee=b=>{var M=Fe(),G=s(M);o(M),K(()=>c(G,`${t(l).files.length??""} file${t(l).files.length===1?"":"s"}`)),_(b,M)};Z(te,b=>{t(l).status!=="completed"&&b(ee)})}o(rt);var oe=d(rt,2);{var ae=b=>{var M=Ae(),G=s(M);{var dt=A=>{var X=Ie();_(A,X)},it=A=>{var X=ge(),se=be(X);ut(se,17,()=>t(l).files,mt,(re,E)=>{const H=p(()=>R(t(E).percentage)),ne=p(()=>_t(t(H)));var lt=Te(),ct=s(lt),vt=s(ct),de=s(vt,!0);o(vt);var ft=d(vt,2),ie=s(ft);o(ft),o(ct);var pt=d(ct,2),Ft=s(pt);o(pt);var It=d(pt,2),xt=s(It),le=s(xt);o(xt);var Tt=d(xt,2),ce=s(Tt);o(Tt),o(It),o(lt),K((ve,fe,pe,xe,ue,me)=>{c(de,t(E).name),L(ft,1,t(H)>=100?"text-green-400":t(H)<=0?"text-red-400":"text-exo-yellow"),c(ie,`${ve??""}%`),L(Ft,1,`absolute inset-y-0 left-0 bg-gradient-to-r ${t(ne)} transition-all duration-300`,"svelte-19lfojq"),Ct(Ft,fe),c(le,`${pe??""} / ${xe??""}`),c(ce,`${ue??""} • ETA ${me??""}`)},[()=>t(H).toFixed(1),()=>`width: ${t(H).toFixed(1)}%`,()=>P(t(E).downloadedBytes),()=>P(t(E).totalBytes),()=>yt(t(E).speed),()=>gt(t(E).etaMs)]),_(re,lt)}),_(A,X)};Z(G,A=>{t(l).files.length===0?A(dt):A(it,!1)})}o(M),_(b,M)};Z(oe,b=>{t($)&&b(ae)})}o(w),K((b,M,G,dt,it)=>{c(k,t(l).prettyName??t(l).modelId),c(Qt,t(l).modelId),c(Vt,`${b??""} / ${M??""}`),L(Q,1,`text-xs font-mono ${t(h)>=100?"text-green-400":t(h)<=0?"text-red-400":"text-exo-yellow"}`),c(Xt,`${G??""}%`),Oe(V,"aria-expanded",t($)),L(Yt,0,De(t($)?"transform rotate-180 origin-center transition-transform duration-150":"transition-transform duration-150")),L(Nt,1,`absolute inset-y-0 left-0 bg-gradient-to-r ${t(N)} transition-all duration-300`,"svelte-19lfojq"),Ct(Nt,dt),c(Zt,it)},[()=>P(t(l).downloadedBytes),()=>P(t(l).totalBytes),()=>t(h).toFixed(1),()=>`width: ${t(h).toFixed(1)}%`,()=>t(l).status==="completed"?"Completed":`${yt(t(l).speed)} • ETA ${gt(t(l).etaMs)}`]),_(D,w)}),o(i),K(D=>{c(F,t(r).nodeName),c(j,t(r).nodeId),c(g,D),c(W,`/${t(r).models.length??""} models`)},[()=>t(r).models.filter(D=>D.status==="completed").length]),_(n,i)}),o(a),_(e,a)};Z(Rt,e=>{t(Ut)?e(Jt,!1):e(Wt)})}o(Mt),o(et),K(e=>c(Pt,`Last update: ${e??""}`),[()=>t(ht)?new Date(t(ht)).toLocaleTimeString():"n/a"]),_(St,et),we()}Me(["click"]);export{Pe as component};
